{
  "hash": "a7527e2b8ec273502353e36fc692f254",
  "result": {
    "markdown": "---\ntitle: \"Lithium News\"\nformat: html\n---\n\n::: {.cell execution_count=1}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Libraries\"}\nfrom datetime import date\nfrom dateutil.relativedelta import relativedelta\nfrom newsapi.newsapi_client import NewsApiClient\nimport pandas as pd\n\nimport json\nfrom ibm_watson import NaturalLanguageUnderstandingV1\nfrom ibm_cloud_sdk_core.authenticators import IAMAuthenticator\nfrom ibm_watson.natural_language_understanding_v1 import Features, SentimentOptions\n\nimport os\n```\n:::\n\n\n### News API\n\n::: {.cell execution_count=2}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Code\"}\ndate = date.today()\ndate_past = date - relativedelta(days=12)\n\nf = open('../auth.k','r', encoding=\"utf-8\")\nak = f.readlines()\nf.close()\n\nnewsapi = NewsApiClient(api_key=ak[0])\n\nsources = newsapi.get_sources()\n\nsources = pd.DataFrame(sources['sources'])\n\nsources = sources[(sources['language'] == 'en') & (sources['country'] == 'us') & ~sources['category'].isin(['sports', 'entertainment', 'health'])]\n\nsources.head(10)\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>name</th>\n      <th>description</th>\n      <th>url</th>\n      <th>category</th>\n      <th>language</th>\n      <th>country</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>abc-news</td>\n      <td>ABC News</td>\n      <td>Your trusted source for breaking news, analysi...</td>\n      <td>https://abcnews.go.com</td>\n      <td>general</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>al-jazeera-english</td>\n      <td>Al Jazeera English</td>\n      <td>News, analysis from the Middle East and worldw...</td>\n      <td>http://www.aljazeera.com</td>\n      <td>general</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>ars-technica</td>\n      <td>Ars Technica</td>\n      <td>The PC enthusiast's resource. Power users and ...</td>\n      <td>http://arstechnica.com</td>\n      <td>technology</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>associated-press</td>\n      <td>Associated Press</td>\n      <td>The AP delivers in-depth coverage on the inter...</td>\n      <td>https://apnews.com/</td>\n      <td>general</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>axios</td>\n      <td>Axios</td>\n      <td>Axios are a new media company delivering vital...</td>\n      <td>https://www.axios.com</td>\n      <td>general</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>bloomberg</td>\n      <td>Bloomberg</td>\n      <td>Bloomberg delivers business and markets news, ...</td>\n      <td>http://www.bloomberg.com</td>\n      <td>business</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>breitbart-news</td>\n      <td>Breitbart News</td>\n      <td>Syndicated news and opinion website providing ...</td>\n      <td>http://www.breitbart.com</td>\n      <td>general</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>business-insider</td>\n      <td>Business Insider</td>\n      <td>Business Insider is a fast-growing business si...</td>\n      <td>http://www.businessinsider.com</td>\n      <td>business</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>cbs-news</td>\n      <td>CBS News</td>\n      <td>CBS News: dedicated to providing the best in j...</td>\n      <td>http://www.cbsnews.com</td>\n      <td>general</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>cnn</td>\n      <td>CNN</td>\n      <td>View the latest news and breaking news today f...</td>\n      <td>http://us.cnn.com</td>\n      <td>general</td>\n      <td>en</td>\n      <td>us</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Code\"}\ndf_sources = ', '.join(sources['id'].astype(str))\n\ndf_domains = ', '.join(sources['url'].astype(str))\n\nall_articles = newsapi.get_everything(q='lithium',\n                                      sources=str(df_sources),\n                                      domains=str(df_domains),\n                                      from_param=date_past,\n                                      to=date,\n                                      language='en',\n                                      sort_by='relevancy')\n\ndf_articles = pd.DataFrame(all_articles['articles'])\n\ndf_articles.head(10)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>source</th>\n      <th>author</th>\n      <th>title</th>\n      <th>description</th>\n      <th>url</th>\n      <th>urlToImage</th>\n      <th>publishedAt</th>\n      <th>content</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>{'id': 'abc-news', 'name': 'ABC News'}</td>\n      <td>ABC News</td>\n      <td>WATCH: CCTV captures terrifying moment E-bike ...</td>\n      <td>CCTV captures the moment an e-bike's lithium-i...</td>\n      <td>https://abcnews.go.com/US/video/cctv-captures-...</td>\n      <td>https://i.abcnewsfe.com/a/7d89adcc-4f6c-4a61-9...</td>\n      <td>2023-10-04T11:03:13Z</td>\n      <td>&lt;ul&gt;&lt;li&gt;Whats next for Russia? \\r\\n&lt;/li&gt;&lt;li&gt;Wh...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>{'id': 'the-next-web', 'name': 'The Next Web'}</td>\n      <td>Ioanna Lykiardopoulou</td>\n      <td>French startup bags €40M for unique CO2 batter...</td>\n      <td>Lyon-based Mecaware has raised €40mn in fundin...</td>\n      <td>https://thenextweb.com/news/french-startup-40m...</td>\n      <td>https://img-cdn.tnwcdn.com/image/tnw-blurple?f...</td>\n      <td>2023-10-09T14:05:22Z</td>\n      <td>Lyon-based Mecaware has raised 40mn in funding...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>{'id': 'ars-technica', 'name': 'Ars Technica'}</td>\n      <td>Ryan Waniata</td>\n      <td>25 of the most popular Amazon Prime Day deals ...</td>\n      <td>AirPods, docking stations, Switch games, and m...</td>\n      <td>https://arstechnica.com/shopping/2023/10/25-of...</td>\n      <td>https://cdn.arstechnica.net/wp-content/uploads...</td>\n      <td>2023-10-11T22:03:33Z</td>\n      <td>Enlarge/ The case for AirPods Pro.\\r\\n5 with \\...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>{'id': 'abc-news', 'name': 'ABC News'}</td>\n      <td>FARAI MUTSAKA Associated Press</td>\n      <td>Death toll in collapsed Zimbabwe gold mine exp...</td>\n      <td>Zimbabwe's vice president says the death toll ...</td>\n      <td>https://abcnews.go.com/Business/wireStory/deat...</td>\n      <td>https://i.abcnewsfe.com/a/9b5f9dbd-61d8-4bf8-8...</td>\n      <td>2023-10-01T12:32:04Z</td>\n      <td>HARARE, Zimbabwe -- The death toll from a shaf...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>{'id': 'ars-technica', 'name': 'Ars Technica'}</td>\n      <td>Jonathan M. Gitlin</td>\n      <td>The 2023 Toyota Prius Prime is a mostly pleasa...</td>\n      <td>Toyota has helpfully increased the size of the...</td>\n      <td>https://arstechnica.com/cars/2023/10/the-2023-...</td>\n      <td>https://cdn.arstechnica.net/wp-content/uploads...</td>\n      <td>2023-10-11T16:47:27Z</td>\n      <td>Enlarge/ After a confusing mess for the last g...</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>{'id': 'next-big-future', 'name': 'Next Big Fu...</td>\n      <td>Brian Wang</td>\n      <td>Lithium Battery Capacity Will Quadruple by 2030</td>\n      <td>Lithium ion battery capacity is set to grow fo...</td>\n      <td>https://www.nextbigfuture.com/2023/10/lithium-...</td>\n      <td>https://nextbigfuture.s3.amazonaws.com/uploads...</td>\n      <td>2023-10-05T21:18:06Z</td>\n      <td>Brian Wang is a Futurist Thought Leader and a ...</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>{'id': 'techradar', 'name': 'TechRadar'}</td>\n      <td>Carrie Marshall</td>\n      <td>Remember the weird, wireless wall-hung OLED TV...</td>\n      <td>Displace TV's unusual wall-mounted TV doesn't ...</td>\n      <td>https://www.techradar.com/televisions/remember...</td>\n      <td>https://cdn.mos.cms.futurecdn.net/JSrbNjmPvXWq...</td>\n      <td>2023-10-06T11:20:30Z</td>\n      <td>Displace TV isn't like other TVs: even the bes...</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>{'id': 'newsweek', 'name': 'Newsweek'}</td>\n      <td>Anna Skinner</td>\n      <td>Rare Metal Discovery Gives China a Boost</td>\n      <td>The find could widen China's lead in the elect...</td>\n      <td>https://www.newsweek.com/rare-metal-discovery-...</td>\n      <td>https://d.newsweek.com/en/full/2293356/rare-me...</td>\n      <td>2023-10-11T16:56:55Z</td>\n      <td>Chinese scientists recently unearthed a rare o...</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>{'id': 'techradar', 'name': 'TechRadar'}</td>\n      <td>Sponsored</td>\n      <td>The RAINBOW 2 Pro controller: Elite performanc...</td>\n      <td>The Rainbow 2 Pro from BigBig Won finds the ha...</td>\n      <td>https://www.techradar.com/gaming/gaming-access...</td>\n      <td>https://cdn.mos.cms.futurecdn.net/TfuzjXLCcTnN...</td>\n      <td>2023-10-05T22:38:12Z</td>\n      <td>PC gamers have long embraced RGB lighting sche...</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>{'id': 'cbs-news', 'name': 'CBS News'}</td>\n      <td>Ben Tracy, Analisa Novak</td>\n      <td>EV battery manufacturing energizes southern co...</td>\n      <td>Billions of dollars in electric vehicle batter...</td>\n      <td>https://www.cbsnews.com/news/ev-battery-manufa...</td>\n      <td>https://assets1.cbsnewsstatic.com/hub/i/r/2023...</td>\n      <td>2023-10-04T13:30:33Z</td>\n      <td>As the auto workers' strike enters its third w...</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n***\n\n### IBM Watson - Sentiment Analysis\n\n::: {.cell execution_count=4}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Code\"}\ndf_content = pd.DataFrame(df_articles, columns=['source', 'content', 'publishedAt'])\ndf_content['source'] = df_content['source'].apply(lambda x: x['id'])\n\nauthenticator = IAMAuthenticator('_4YE1Qj6PFjke1zYsp7Kapgfu5laaaBE1E_ZUw1IiUPa')\nnatural_language_understanding = NaturalLanguageUnderstandingV1(\n    version='2020-08-01',\n    authenticator=authenticator\n)\n\nnatural_language_understanding.set_service_url('https://api.us-south.natural-language-understanding.watson.cloud.ibm.com/instances/8b0909d1-3768-4c54-b80d-b9817610e36d')\n\n#IBM Watson\ni = 0\nibm_source = []\nibm_date = []\nibm_score = []\nibm_label = []\nfor index, row in df_content.iterrows():\n    response = natural_language_understanding.analyze(\n    text=row['content'], language = 'en',\n    features=Features(sentiment=SentimentOptions())).get_result()\n\n    s = row['source']\n    ibm_source.append(s)\n    d = row['publishedAt']\n    ibm_date.append(d)\n    x = response['sentiment']['document']['score']\n    x = round(x, 4)\n    ibm_score.append(x)\n    y = response['sentiment']['document']['label']\n    ibm_label.append(y)\n    # print(response['sentiment']['document']['score'])\n    # print(response['sentiment']['document']['label'])\n    # print(json.dumps(response, indent=2))\n\n    i=i+1   \n\nresults = {\"id\": ibm_source, \"ibm_date\": ibm_date, \"ibm_score\": ibm_score, \"ibm_label\": ibm_label}\n\nresults = pd.DataFrame(data = results)\n```\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Code\"}\ndate = date.today()\nname = '../' + str(date) + '_results.csv'\n\nresults.to_csv(name, index=False)\n\nresults = results.merge(sources, how='left')\n\nresults = pd.DataFrame(results, columns=['name', 'category', 'ibm_score', 'ibm_label', 'ibm_date'])\n\nresults = results.rename(columns={'ibm_date': 'date'})\n\nresults['date'] = pd.to_datetime(results['date'])\n\nresults['date'] = results['date'].dt.date\n\nresults.head(10)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>name</th>\n      <th>category</th>\n      <th>ibm_score</th>\n      <th>ibm_label</th>\n      <th>date</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ABC News</td>\n      <td>general</td>\n      <td>-0.6553</td>\n      <td>negative</td>\n      <td>2023-10-04</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>The Next Web</td>\n      <td>technology</td>\n      <td>0.5855</td>\n      <td>positive</td>\n      <td>2023-10-09</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Ars Technica</td>\n      <td>technology</td>\n      <td>-0.8725</td>\n      <td>negative</td>\n      <td>2023-10-11</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>ABC News</td>\n      <td>general</td>\n      <td>-0.7182</td>\n      <td>negative</td>\n      <td>2023-10-01</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Ars Technica</td>\n      <td>technology</td>\n      <td>0.0000</td>\n      <td>neutral</td>\n      <td>2023-10-11</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>Next Big Future</td>\n      <td>science</td>\n      <td>0.0000</td>\n      <td>neutral</td>\n      <td>2023-10-05</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>TechRadar</td>\n      <td>technology</td>\n      <td>-0.9441</td>\n      <td>negative</td>\n      <td>2023-10-06</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>Newsweek</td>\n      <td>general</td>\n      <td>0.8858</td>\n      <td>positive</td>\n      <td>2023-10-11</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>TechRadar</td>\n      <td>technology</td>\n      <td>0.0000</td>\n      <td>neutral</td>\n      <td>2023-10-05</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>CBS News</td>\n      <td>general</td>\n      <td>-0.6365</td>\n      <td>negative</td>\n      <td>2023-10-04</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "3_5_news_api_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}